<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiNKR Pickleball Americano Tournament</title>
    <!-- Working CDN URLs -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif; 
            background: #6c7e85; 
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            touch-action: manipulation;
            padding-bottom: 60px;
        }
        .btn { 
            border: none; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.2s; 
            touch-action: manipulation;
        }
        .btn:hover { transform: translateY(-1px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .input { 
            border: 2px solid #64748b; 
            border-radius: 4px; 
            padding: 12px; 
            font-size: 16px; 
            outline: none;
            touch-action: manipulation;
            -webkit-appearance: none;
            -moz-appearance: textfield;
        }
        .input:focus { border-color: #deff01; }
        .input::-webkit-outer-spin-button,
        .input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .card { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(10px); 
            border-radius: 12px; 
            padding: 20px; 
            margin: 16px auto;
            width: 100%;
        }
        .error-message {
            background: #fed7d7;
            color: #9b2c2c;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
        }
        .success-message {
            background: #c6f6d5;
            color: #276749;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #deff01;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* New Design Styles */
        .tournament-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 52px auto 46px;
            max-width: 350px;
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            background: black;
            border-radius: 50px;
            padding: 8px 16px;
            gap: 8px;
        }
        
        .timer-container.warning {
            background: #dc2626;
        }
        
        .round-indicator {
            width: 24px;
            height: 24px;
            background: #deff01;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
            font-weight: bold;
            font-size: 14px;
        }
        
        .timer-display {
            color: white;
            font-size: 18px;
            font-weight: 500;
            min-width: 60px;
            text-align: center;
        }
        
        .play-button {
            width: 24px;
            height: 24px;
            background: #deff01;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            padding: 0;
        }
        
        .edit-header-btn {
            width: 28px;
            height: 28px;
            background: #deff01;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            padding: 0;
        }
        
        /* Court Styles */
        .court-container {
            position: relative;
            margin-bottom: 14px;
            max-width: 289px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .court-top-post {
            display: flex;
            justify-content: center;
            margin-bottom: 4px;
        }
        
        .court-post {
            width: 12px;
            height: 16px;
            background: #8b9a5c;
            border-radius: 4px;
        }
        
        .court-grid {
            width: 289px;
            height: 131px;
            background: transparent;
            border: 2px solid white;
            border-radius: 4px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            position: relative;
        }
        
        .court-player {
            background: #4a6fa5;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'SF Pro Display', Helvetica, sans-serif;
            font-weight: 500;
            font-size: 14.8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .court-player:hover {
            background: #5a7fb5;
        }
        
        .court-player.top-left {
            border-right: 1px solid white;
            border-bottom: 1px solid white;
        }
        
        .court-player.top-right {
            border-bottom: 1px solid white;
        }
        
        .court-player.bottom-left {
            border-right: 1px solid white;
        }
        
        .court-edit-btn {
            position: absolute;
            top: 50%;
            right: -32px;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            background: #deff01;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            padding: 0;
        }
        
        .court-bottom-post {
            display: flex;
            justify-content: center;
            margin-top: 4px;
        }
        
        /* Score editing modal */
        .score-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .score-modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 300px;
            width: 90%;
        }
        
        .score-input-group {
            display: flex;
            gap: 16px;
            margin: 20px 0;
            align-items: center;
            justify-content: center;
        }
        
        .score-input {
            width: 60px;
            height: 60px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        .score-input:focus {
            border-color: #deff01;
            outline: none;
        }
        
        /* Sitting players */
        .sitting-players {
            background: rgba(107, 114, 128, 0.7);
            border-radius: 8px;
            padding: 16px;
            margin: 20px auto;
            max-width: 350px;
            color: white;
            text-align: center;
        }
        
        /* Start round button */
        .start-round-container {
            display: flex;
            justify-content: center;
            margin: 26px auto;
            position: relative;
        }
        
        .start-round-shadow {
            position: absolute;
            width: 133px;
            height: 13px;
            top: 28px;
            left: 3px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            filter: blur(18px);
        }
        
        .start-round-btn {
            width: 136px;
            height: 34px;
            background: #deff01;
            color: #323600;
            border-radius: 7px;
            font-family: 'SF Pro Display', Helvetica, sans-serif;
            font-weight: bold;
            font-size: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            z-index: 1;
        }
        
        .start-round-btn:hover {
            background: #c5d601;
            transform: translateY(-1px);
        }
        
        .start-round-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Number input with controls */
        .number-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .number-input-btn {
            background: #deff01;
            color: #1a202c;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .number-input-btn:hover {
            background: #c5d601;
            transform: translateY(-1px);
        }
        
        .number-input-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        /* DiNKR Logo Styling */
        .dinkr-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .dinkr-tagline {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }

        /* Container */
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .wide-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Main tournament container */
        .tournament-container {
            max-width: 350px;
            margin: 0 auto;
            padding: 2.61px;
            background: #6c7e85;
            min-height: 754px;
        }
        
        /* Back button */
        .back-button {
            background: transparent;
            border: none;
            color: white;
            padding: 8px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const { useState, useCallback, useEffect, createElement: h } = React;
        
        // DiNKR Logo Component
        const DiNKRLogo = ({ size = 'normal' }) => {
            const logoSize = size === 'large' ? 80 : 60;
            const textSize = size === 'large' ? '36px' : '28px';
            
            return h('div', { 
                style: { textAlign: 'center', marginBottom: '24px' } 
            }, [
                h('div', { 
                    key: 'logo',
                    className: 'dinkr-logo' 
                }, [
                    h('div', { 
                        key: 'icon',
                        style: {
                            width: logoSize + 'px',
                            height: logoSize + 'px',
                            background: '#deff01',
                            borderRadius: '50%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontSize: Math.round(logoSize * 0.5) + 'px'
                        }
                    }, '🏓'),
                    h('div', { key: 'text' }, [
                        h('div', { 
                            key: 'title',
                            style: {
                                fontSize: textSize,
                                fontWeight: 'bold',
                                color: '#deff01',
                                letterSpacing: '2px'
                            }
                        }, 'DiNKR'),
                        h('div', { 
                            key: 'tagline',
                            className: 'dinkr-tagline' 
                        }, 'MEET YOUR MATCH')
                    ])
                ])
            ]);
        };
        
        // Timer Component
        const Timer = ({ duration, isRunning, onStart, onTimeUp, roundNumber }) => {
            const [timeLeft, setTimeLeft] = useState(duration * 60);
            const [isActive, setIsActive] = useState(false);

            useEffect(() => {
                setTimeLeft(duration * 60);
                setIsActive(false);
            }, [duration]);

            useEffect(() => {
                if (isRunning && !isActive) {
                    setIsActive(true);
                }
            }, [isRunning]);

            useEffect(() => {
                let interval = null;
                if (isActive && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft(time => {
                            if (time <= 1) {
                                setIsActive(false);
                                onTimeUp();
                                return 0;
                            }
                            return time - 1;
                        });
                    }, 1000);
                } else if (!isActive) {
                    clearInterval(interval);
                }
                return () => clearInterval(interval);
            }, [isActive, timeLeft, onTimeUp]);

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const isWarning = timeLeft <= 60;

            return h('div', { 
                className: `timer-container ${isWarning ? 'warning' : ''}` 
            }, [
                h('div', { 
                    key: 'round',
                    className: 'round-indicator' 
                }, roundNumber),
                h('div', { 
                    key: 'time',
                    className: 'timer-display' 
                }, formatTime(timeLeft)),
                h('button', { 
                    key: 'play',
                    className: 'play-button',
                    onClick: onStart,
                    disabled: isActive
                }, h('div', { 
                    style: { 
                        width: 0, 
                        height: 0, 
                        borderLeft: '8px solid black', 
                        borderTop: '5px solid transparent', 
                        borderBottom: '5px solid transparent',
                        marginLeft: '2px'
                    } 
                }))
            ]);
        };

        // Score Edit Modal
        const ScoreEditModal = ({ isOpen, onClose, onSave, initialScores, teamNames }) => {
            const [scoreA, setScoreA] = useState('');
            const [scoreB, setScoreB] = useState('');

            useEffect(() => {
                if (isOpen && initialScores) {
                    setScoreA(initialScores.teamA || '');
                    setScoreB(initialScores.teamB || '');
                }
            }, [isOpen, initialScores]);

            if (!isOpen) return null;

            const handleSave = () => {
                onSave(scoreA, scoreB);
                onClose();
            };

            return h('div', { className: 'score-modal', onClick: onClose }, [
                h('div', { 
                    key: 'content',
                    className: 'score-modal-content',
                    onClick: (e) => e.stopPropagation()
                }, [
                    h('h3', { 
                        key: 'title',
                        style: { textAlign: 'center', marginBottom: '20px', color: '#1a202c' } 
                    }, 'Edit Scores'),
                    h('div', { key: 'scores', className: 'score-input-group' }, [
                        h('div', { key: 'team-a', style: { textAlign: 'center' } }, [
                            h('div', { 
                                key: 'label-a',
                                style: { fontSize: '14px', marginBottom: '8px', color: '#666' } 
                            }, teamNames.teamA),
                            h('input', {
                                key: 'input-a',
                                type: 'tel',
                                className: 'score-input',
                                value: scoreA,
                                onChange: (e) => setScoreA(e.target.value.replace(/[^0-9]/g, '')),
                                onFocus: (e) => e.target.select()
                            })
                        ]),
                        h('div', { 
                            key: 'vs',
                            style: { 
                                fontSize: '20px', 
                                fontWeight: 'bold', 
                                color: '#666',
                                display: 'flex',
                                alignItems: 'center'
                            } 
                        }, 'vs'),
                        h('div', { key: 'team-b', style: { textAlign: 'center' } }, [
                            h('div', { 
                                key: 'label-b',
                                style: { fontSize: '14px', marginBottom: '8px', color: '#666' } 
                            }, teamNames.teamB),
                            h('input', {
                                key: 'input-b',
                                type: 'tel',
                                className: 'score-input',
                                value: scoreB,
                                onChange: (e) => setScoreB(e.target.value.replace(/[^0-9]/g, '')),
                                onFocus: (e) => e.target.select()
                            })
                        ])
                    ]),
                    h('div', { 
                        key: 'buttons',
                        style: { display: 'flex', gap: '12px', justifyContent: 'center', marginTop: '20px' } 
                    }, [
                        h('button', {
                            key: 'cancel',
                            onClick: onClose,
                            style: {
                                padding: '10px 20px',
                                border: '2px solid #ddd',
                                background: 'white',
                                borderRadius: '6px',
                                cursor: 'pointer'
                            }
                        }, 'Cancel'),
                        h('button', {
                            key: 'save',
                            onClick: handleSave,
                            style: {
                                padding: '10px 20px',
                                border: 'none',
                                background: '#deff01',
                                color: '#1a202c',
                                borderRadius: '6px',
                                fontWeight: 'bold',
                                cursor: 'pointer'
                            }
                        }, 'Save')
                    ])
                ])
            ]);
        };

        // Court Component with New Design
        const Court = ({ match, matchIndex, roundIndex, scores, updateScore, onScoreValidation, roundStarted = false, onEditScore }) => {
            const [teamA, teamB] = match;
            const matchScores = scores[roundIndex]?.[matchIndex] || { teamA: '', teamB: '' };
            
            // Check if both scores are entered (for showing edit button)
            const bothScoresEntered = matchScores.teamA && matchScores.teamB && 
                                    parseInt(matchScores.teamA) >= 0 && parseInt(matchScores.teamB) >= 0;

            const handleEditClick = () => {
                const teamNames = {
                    teamA: `${teamA[0].firstName || teamA[0].name} & ${teamA[1].firstName || teamA[1].name}`,
                    teamB: `${teamB[0].firstName || teamB[0].name} & ${teamB[1].firstName || teamB[1].name}`
                };
                onEditScore(roundIndex, matchIndex, matchScores, teamNames);
            };

            return h('div', { className: 'court-container' }, [
                // Top post
                h('div', { key: 'top-post', className: 'court-top-post' },
                    h('div', { className: 'court-post' })
                ),
                
                // Court grid
                h('div', { key: 'court', className: 'court-grid' }, [
                    // Top left player
                    h('div', { 
                        key: 'player-tl',
                        className: 'court-player top-left' 
                    }, teamA[0].firstName || teamA[0].name),
                    
                    // Top right player  
                    h('div', { 
                        key: 'player-tr',
                        className: 'court-player top-right' 
                    }, teamB[0].firstName || teamB[0].name),
                    
                    // Bottom left player
                    h('div', { 
                        key: 'player-bl',
                        className: 'court-player bottom-left' 
                    }, teamA[1].firstName || teamA[1].name),
                    
                    // Bottom right player
                    h('div', { 
                        key: 'player-br',
                        className: 'court-player' 
                    }, teamB[1].firstName || teamB[1].name)
                ]),
                
                // Bottom post
                h('div', { key: 'bottom-post', className: 'court-bottom-post' },
                    h('div', { className: 'court-post' })
                ),
                
                // Edit button (shown when both scores entered)
                bothScoresEntered && roundStarted ? h('button', {
                    key: 'edit',
                    className: 'court-edit-btn',
                    onClick: handleEditClick
                }, h('div', { 
                    style: { 
                        width: '14px', 
                        height: '14px', 
                        fontSize: '12px',
                        color: 'black'
                    } 
                }, '✏️')) : null
            ]);
        };

        // Number Input Component with +/- buttons
        const NumberInput = ({ value, onChange, min = 1, max = 100, label, helpText, style = {} }) => {
            const increment = () => {
                if (value < max) {
                    onChange(value + 1);
                }
            };

            const decrement = () => {
                if (value > min) {
                    onChange(value - 1);
                }
            };

            const handleInputChange = (e) => {
                const newValue = parseInt(e.target.value) || min;
                const clampedValue = Math.max(min, Math.min(max, newValue));
                onChange(clampedValue);
            };

            return h('div', { style: { marginBottom: '20px' } }, [
                h('label', { 
                    key: 'label',
                    style: { display: 'block', fontSize: '16px', fontWeight: '500', marginBottom: '8px', color: 'white' } 
                }, label),
                h('div', {
                    key: 'input-container',
                    className: 'number-input-container'
                }, [
                    h('button', {
                        key: 'decrement',
                        onClick: decrement,
                        disabled: value <= min,
                        className: 'number-input-btn',
                        type: 'button'
                    }, '−'),
                    h('input', { 
                        key: 'input',
                        type: 'number', 
                        min, 
                        max, 
                        value, 
                        onChange: handleInputChange,
                        className: 'input', 
                        style: { 
                            width: '100px',
                            textAlign: 'center',
                            backgroundColor: 'rgba(255, 255, 255, 0.15)', 
                            border: '2px solid rgba(255, 255, 255, 0.3)', 
                            color: 'white',
                            fontSize: '16px',
                            ...style
                        } 
                    }),
                    h('button', {
                        key: 'increment',
                        onClick: increment,
                        disabled: value >= max,
                        className: 'number-input-btn',
                        type: 'button'
                    }, '+')
                ]),
                helpText ? h('p', { 
                    key: 'help',
                    style: { fontSize: '14px', color: '#94a3b8', marginTop: '6px' } 
                }, helpText) : null
            ]);
        };

        // Main Tournament App Component
        const TournamentApp = () => {
            const [step, setStep] = useState(1);
            const [config, setConfig] = useState({
                courts: 2, 
                totalPlayers: 8, 
                rounds: 6, 
                useDefaults: true,
                avoidMMvsFF: true, 
                useRatingBalance: true, 
                ratingFactor: 3, 
                roundDuration: 13
            });
            const [tournament, setTournament] = useState(null);
            const [currentRound, setCurrentRound] = useState(0);
            const [scores, setScores] = useState({});
            const [loading, setLoading] = useState(false);
            const [errorMessage, setErrorMessage] = useState('');
            const [successMessage, setSuccessMessage] = useState('');
            const [roundStarted, setRoundStarted] = useState(false);
            const [editModal, setEditModal] = useState({ isOpen: false, roundIndex: 0, matchIndex: 0, scores: {}, teamNames: {} });

            const showError = (message) => {
                setErrorMessage(message);
                setTimeout(() => setErrorMessage(''), 5000);
            };

            const showSuccess = (message) => {
                setSuccessMessage(message);
                setTimeout(() => setSuccessMessage(''), 3000);
            };

            const updateScore = (roundIndex, matchIndex, team, value) => {
                setScores(prev => ({
                    ...prev,
                    [roundIndex]: {
                        ...prev[roundIndex],
                        [matchIndex]: {
                            ...prev[roundIndex]?.[matchIndex],
                            [team]: value
                        }
                    }
                }));
            };

            const generateTournament = async () => {
                setLoading(true);
                setErrorMessage('');
                
                try {
                    const requestData = {
                        courts: config.courts,
                        players: [],
                        rounds: config.rounds,
                        useDefaults: config.useDefaults,
                        avoidMMvsFF: config.avoidMMvsFF,
                        useRatingBalance: config.useRatingBalance,
                        ratingFactor: config.ratingFactor,
                        roundDuration: config.roundDuration,
                        totalPlayers: config.totalPlayers
                    };

                    const response = await fetch('/api/generate_tournament', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(requestData)
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        setTournament(result);
                        setCurrentRound(0);
                        setScores({});
                        setRoundStarted(false);
                        showSuccess('Tournament generated successfully!');
                        setStep(2);
                    } else {
                        showError(result.error || 'Failed to generate tournament');
                    }
                } catch (error) {
                    showError('Network error: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const startRound = () => {
                setRoundStarted(true);
                showSuccess('Round started! Timer is running.');
            };

            const onTimeUp = () => {
                showSuccess('Time is up! Please finish entering scores.');
            };

            const onScoreValidation = (roundIndex, matchIndex, scoreA, scoreB) => {
                if (scoreA < 11 && scoreB < 11 && (scoreA > 0 || scoreB > 0)) {
                    showError('Games go to 11 points. Please check your scores.');
                }
            };

            const handleEditScore = (roundIndex, matchIndex, currentScores, teamNames) => {
                setEditModal({
                    isOpen: true,
                    roundIndex,
                    matchIndex,
                    scores: currentScores,
                    teamNames
                });
            };

            const saveEditedScore = (scoreA, scoreB) => {
                updateScore(editModal.roundIndex, editModal.matchIndex, 'teamA', scoreA);
                updateScore(editModal.roundIndex, editModal.matchIndex, 'teamB', scoreB);
                showSuccess('Scores updated successfully!');
            };

            // Step 1: Configuration
            if (step === 1) {
                return h('div', { 
                    style: { 
                        minHeight: '100vh', 
                        background: '#6c7e85', 
                        color: 'white',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        padding: '24px'
                    } 
                }, [
                    h('div', {
                        key: 'container',
                        style: {
                            width: '100%',
                            maxWidth: '600px'
                        }
                    }, [
                        h(DiNKRLogo, { key: 'logo' }),
                        
                        errorMessage ? h('div', { key: 'error', className: 'error-message' }, errorMessage) : null,
                        successMessage ? h('div', { key: 'success', className: 'success-message' }, successMessage) : null,
                        
                        h('div', { key: 'config', className: 'card' }, [
                            h('h3', { 
                                key: 'title', 
                                style: { fontSize: '20px', fontWeight: '600', marginBottom: '20px', color: '#deff01', textAlign: 'center' } 
                            }, 'Tournament Configuration'),
                            h('div', { 
                                key: 'fields', 
                                style: { display: 'flex', flexDirection: 'column', gap: '20px' } 
                            }, [
                                h(NumberInput, {
                                    key: 'courts',
                                    value: config.courts,
                                    onChange: (value) => setConfig(prev => ({...prev, courts: value})),
                                    min: 1,
                                    max: 10,
                                    label: 'Number of Courts'
                                }),
                                h(NumberInput, {
                                    key: 'players',
                                    value: config.totalPlayers,
                                    onChange: (value) => setConfig(prev => ({...prev, totalPlayers: value})),
                                    min: 4,
                                    max: 100,
                                    label: 'Number of Players',
                                    helpText: `Supports any number of players. ${config.courts * 4} will play each round.`
                                }),
                                h(NumberInput, {
                                    key: 'rounds',
                                    value: config.rounds,
                                    onChange: (value) => setConfig(prev => ({...prev, rounds: value})),
                                    min: 3,
                                    max: 15,
                                    label: 'Number of Rounds'
                                }),
                                h(NumberInput, {
                                    key: 'duration',
                                    value: config.roundDuration,
                                    onChange: (value) => setConfig(prev => ({...prev, roundDuration: value})),
                                    min: 10,
                                    max: 15,
                                    label: 'Round Duration (minutes)',
                                    helpText: 'Range: 10-15 minutes (default: 13)'
                                })
                            ])
                        ]),
                        
                        loading ? h('div', { key: 'loading', className: 'spinner' }) : null,
                        
                        h('button', { 
                            key: 'generate', 
                            onClick: generateTournament, 
                            disabled: loading, 
                            className: 'btn', 
                            style: { 
                                width: '100%', 
                                backgroundColor: loading ? '#64748b' : '#deff01', 
                                color: '#1e293b', 
                                padding: '18px', 
                                fontSize: '18px',
                                fontWeight: 'bold',
                                borderRadius: '12px'
                            } 
                        }, loading ? 'Generating Tournament...' : 'Generate Tournament')
                    ])
                ]);
            }

            // Step 2: Tournament Display with New Design
            if (step === 2 && tournament) {
                const currentRoundData = tournament.schedule[currentRound];
                const roundNumber = currentRound + 1;

                return h('div', { 
                    className: 'tournament-container',
                    style: { minHeight: '100vh' }
                }, [
                    // Header with timer
                    h('header', { 
                        key: 'header',
                        className: 'tournament-header' 
                    }, [
                        h(Timer, {
                            key: 'timer',
                            duration: config.roundDuration,
                            isRunning: roundStarted,
                            onStart: startRound,
                            onTimeUp: onTimeUp,
                            roundNumber: roundNumber
                        }),
                        h('button', { 
                            key: 'edit-header',
                            className: 'edit-header-btn',
                            onClick: () => setStep(1)
                        }, h('div', { 
                            style: { 
                                width: '16px', 
                                height: '16px',
                                fontSize: '12px',
                                color: 'black'
                            } 
                        }, '✏️'))
                    ]),

                    // Error/Success messages
                    errorMessage ? h('div', { 
                        key: 'error', 
                        className: 'error-message',
                        style: { margin: '0 30px 16px' }
                    }, errorMessage) : null,
                    
                    successMessage ? h('div', { 
                        key: 'success', 
                        className: 'success-message',
                        style: { margin: '0 30px 16px' }
                    }, successMessage) : null,

                    // Main courts section
                    h('main', { 
                        key: 'main',
                        style: { 
                            display: 'flex', 
                            flexDirection: 'column', 
                            gap: '14px', 
                            width: '100%', 
                            padding: '0 30px' 
                        } 
                    }, [
                        // Render all courts dynamically
                        ...currentRoundData.matches.map((match, matchIndex) => 
                            h(Court, { 
                                key: matchIndex, 
                                match, 
                                matchIndex, 
                                roundIndex: currentRound, 
                                scores,
                                updateScore,
                                onScoreValidation,
                                roundStarted,
                                onEditScore: handleEditScore
                            })
                        ),

                        // Sitting players (if any)
                        currentRoundData.sit_outs && currentRoundData.sit_outs.length > 0 ? 
                            h('div', { 
                                key: 'sitting',
                                className: 'sitting-players'
                            }, [
                                h('strong', { 
                                    key: 'label',
                                    style: { color: '#deff01' } 
                                }, 'Sitting Out: '), 
                                h('span', { key: 'names' }, currentRoundData.sit_outs.join(', '))
                            ]) : null
                    ]),

                    // Start round button
                    h('footer', { key: 'footer', className: 'start-round-container' }, [
                        h('div', { key: 'shadow', className: 'start-round-shadow' }),
                        h('button', { 
                            key: 'start',
                            className: 'start-round-btn',
                            onClick: startRound,
                            disabled: roundStarted
                        }, roundStarted ? `Round ${roundNumber} Started` : `Start Round ${roundNumber}`)
                    ]),

                    // Score edit modal
                    h(ScoreEditModal, {
                        key: 'modal',
                        isOpen: editModal.isOpen,
                        onClose: () => setEditModal(prev => ({ ...prev, isOpen: false })),
                        onSave: saveEditedScore,
                        initialScores: editModal.scores,
                        teamNames: editModal.teamNames
                    })
                ]);
            }

            // Loading state
            return h('div', { 
                style: { 
                    padding: '40px', 
                    textAlign: 'center', 
                    minHeight: '100vh', 
                    background: '#6c7e85', 
                    color: 'white',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center'
                } 
            }, [
                h(DiNKRLogo, { key: 'logo', size: 'large' }),
                h('h2', { style: { marginBottom: '20px' } }, 'Loading Tournament System...'),
                h('div', { className: 'spinner' })
            ]);
        };

        ReactDOM.render(React.createElement(TournamentApp), document.getElementById('root'));
    </script>
</body>
</html>